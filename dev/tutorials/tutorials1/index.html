<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ğŸŸ¡ Temperature model (codim 2) Â· Bifurcation Analysis in Julia</title><meta name="title" content="ğŸŸ¡ Temperature model (codim 2) Â· Bifurcation Analysis in Julia"/><meta property="og:title" content="ğŸŸ¡ Temperature model (codim 2) Â· Bifurcation Analysis in Julia"/><meta property="twitter:title" content="ğŸŸ¡ Temperature model (codim 2) Â· Bifurcation Analysis in Julia"/><meta name="description" content="Documentation for Bifurcation Analysis in Julia."/><meta property="og:description" content="Documentation for Bifurcation Analysis in Julia."/><meta property="twitter:description" content="Documentation for Bifurcation Analysis in Julia."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Bifurcation Analysis in Julia logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Bifurcation Analysis in Julia</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../capabilities/">Overview of capabilities</a></li><li><a class="tocitem" href="../../gettingstarted/">Getting Started with BifurcationKit</a></li><li><a class="tocitem" href="../tutorials/">Tutorials</a></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Basics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guidelines/">Guidelines</a></li><li><a class="tocitem" href="../../educational/">Educational introduction</a></li><li><a class="tocitem" href="../../overview/">Overview</a></li><li><a class="tocitem" href="../../plotting/">Plot functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Problems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../BifProblem/">Bifurcation Problem</a></li><li><a class="tocitem" href="../../diffeq/">DiffEq wrapper</a></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Periodic Orbits</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../periodicOrbit/">Introduction</a></li><li><a class="tocitem" href="../../periodicOrbitTrapeze/">Trapezoid</a></li><li><a class="tocitem" href="../../periodicOrbitCollocation/">Collocation</a></li><li><a class="tocitem" href="../../periodicOrbitShooting/">Shooting</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">Symmetries / Waves</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../intro_wave/">Introduction</a></li><li><a class="tocitem" href="../../waveEigen/">Eigen Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Continuation methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../IntroContinuation/">Introduction</a></li><li><a class="tocitem" href="../../Predictors/">Predictors / correctors</a></li><li><a class="tocitem" href="../../PALC/">PALC</a></li><li><a class="tocitem" href="../../MooreSpence/">Moore-Penrose continuation</a></li><li><a class="tocitem" href="../../hybrid/">AutoSwitch</a></li><li><a class="tocitem" href="../../ANM/">ANM</a></li><li><a class="tocitem" href="../../DeflatedContinuation/">Deflated continuation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Functionalities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-8-1" type="checkbox"/><label class="tocitem" for="menuitem-8-1"><span class="docs-label">Nonlinear equations (Newton)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../newton/">Krylov-Newton algorithm</a></li><li><a class="tocitem" href="../../deflatedproblem/">Deflated problems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2" type="checkbox"/><label class="tocitem" for="menuitem-8-2"><span class="docs-label">Bifurcations (equilibria)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../detectionBifurcation/">Bifurcation detection (1 param)</a></li><li><a class="tocitem" href="../../codim2Continuation/">Fold / Hopf Continuation (2 params)</a></li><li><a class="tocitem" href="../../codim3Continuation/">Bogdanov-Takens refinement (3 params)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-3" type="checkbox"/><label class="tocitem" for="menuitem-8-3"><span class="docs-label">Bifurcations (periodic orbits)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../detectionBifurcationPO/">Bifurcation detection (1 param)</a></li><li><a class="tocitem" href="../../FoldContinuationPO/">Fold continuation (2 params)</a></li><li><a class="tocitem" href="../../PDContinuationPO/">Period-Doubling continuation (2 params)</a></li><li><a class="tocitem" href="../../NSContinuationPO/">Neimark-Sacker continuation (2 params)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-4" type="checkbox"/><label class="tocitem" for="menuitem-8-4"><span class="docs-label">Normal form (equilibria)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../simplebp/">Simple branch point</a></li><li><a class="tocitem" href="../../nonsimplebp/">Non-simple branch point</a></li><li><a class="tocitem" href="../../simplehopf/">Simple Hopf</a></li><li><a class="tocitem" href="../../cusp/">Cusp</a></li><li><a class="tocitem" href="../../bt/">Bogdanov-Takens</a></li><li><a class="tocitem" href="../../bautin/">Bautin</a></li><li><a class="tocitem" href="../../zh/">Zero-Hopf</a></li><li><a class="tocitem" href="../../hh/">Hopf-Hopf</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-5" type="checkbox"/><label class="tocitem" for="menuitem-8-5"><span class="docs-label">Normal form (periodic orbits)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bppo/">Simple branch point</a></li><li><a class="tocitem" href="../../pd/">Period-doubling</a></li><li><a class="tocitem" href="../../ns/">Neimark-Sacker</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-6" type="checkbox"/><label class="tocitem" for="menuitem-8-6"><span class="docs-label">Branch switching</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../intro-abs/">Introduction</a></li><li><a class="tocitem" href="../../abs-from-eq/">From equilibria to equilibria</a></li><li><a class="tocitem" href="../../abs-from-hopf/">From Hopf/PD/Branch to periodic orbits</a></li><li><a class="tocitem" href="../../abs-from-codim2-eq/">From codim 2 to equilibria</a></li><li><a class="tocitem" href="../../abs-from-codim2-po/">From codim 2 to periodic orbits</a></li></ul></li><li><a class="tocitem" href="../../BifurcationDiagram/">Automatic Bifurcation diagram</a></li><li><a class="tocitem" href="../../EventCallback/">Event handling and Callback</a></li><li><a class="tocitem" href="../../iterator/">Iterator Interface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Options</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../linearsolver/">Linear solvers</a></li><li><a class="tocitem" href="../../borderedlinearsolver/">Bordered linear solvers</a></li><li><a class="tocitem" href="../../eigensolver/">Eigen solvers</a></li><li><a class="tocitem" href="../../Borderedarrays/">Bordered arrays</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">Contributing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1" type="checkbox"/><label class="tocitem" for="menuitem-10-1"><span class="docs-label">Interfaces</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../interfaceLS/">Vector</a></li><li><a class="tocitem" href="../../interfaceLS/">Linear / eigen Solvers</a></li><li><a class="tocitem" href="../../interfacePred/">Predictor / corrector</a></li><li><a class="tocitem" href="../../interfaceFlow/">Flow</a></li></ul></li></ul></li><li><a class="tocitem" href="../../faq/">Frequently asked questions</a></li><li><a class="tocitem" href="../../migration/">Migration from old versions</a></li><li><a class="tocitem" href="../../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>ğŸŸ¡ Temperature model (codim 2)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ğŸŸ¡ Temperature model (codim 2)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/bifurcationkit/BifurcationKitDocs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/bifurcationkit/BifurcationKitDocs.jl/blob/main/docs/src/tutorials/tutorials1.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="temperature"><a class="docs-heading-anchor" href="#temperature">ğŸŸ¡ Temperature model (codim 2)</a><a id="temperature-1"></a><a class="docs-heading-anchor-permalink" href="#temperature" title="Permalink"></a></h1><ul><li><a href="#temperature">ğŸŸ¡ Temperature model (codim 2)</a></li><li class="no-marker"><ul><li><a href="#Continuation-of-Fold-points">Continuation of Fold points</a></li><li><a href="#Using-GMRES-or-another-linear-solver">Using GMRES or another linear solver</a></li></ul></li></ul><blockquote><p>This is a classical example from the <strong>Trilinos</strong> library.</p></blockquote><p>This is a simple example in which we aim at solving <span>$\Delta T+\alpha N(T,\beta)=0$</span> with boundary conditions <span>$T(0) = T(1)=\beta$</span>. This example is coded in <code>examples/chan.jl</code>. We start with some imports:</p><pre><code class="language-julia hljs">using Revise, BifurcationKit, LinearAlgebra, Plots
const BK = BifurcationKit

N(x; a = 0.5, b = 0.01) = 1 + (x + a*x^2)/(1 + b*x^2)</code></pre><p>We then write our functional:</p><pre><code class="language-julia hljs">function F_chan(x, p)
	(;Î±, Î²) = p
	f = similar(x)
	n = length(x)
	f[1] = x[1] - Î²
	f[n] = x[n] - Î²
	for i=2:n-1
		f[i] = (x[i-1] - 2 * x[i] + x[i+1]) * (n-1)^2 + Î± * N(x[i], b = Î²)
	end
	return f
end</code></pre><p>We want to call a Newton solver. We first need an initial guess:</p><pre><code class="language-julia hljs">n = 101
sol0 = [(i-1)*(n-i)/n^2+0.1 for i=1:n]

# set of parameters
par = (Î± = 3.3, Î² = 0.01)</code></pre><p>Finally, we need to provide some parameters for the Newton iterations. This is done by calling</p><pre><code class="language-julia hljs">optnewton = NewtonPar(tol = 1e-11, verbose = true)</code></pre><p>We call the Newton solver:</p><pre><code class="language-julia hljs">prob = BifurcationProblem(F_chan, sol0, par, (@optic _.Î±),
	# function to plot the solution
	plot_solution = (x, p; k...) -&gt; plot!(x; ylabel=&quot;solution&quot;, label=&quot;&quot;, k...))
sol = @time BK.solve( prob, Newton(), optnewton)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Newton step         residual      linear iterations â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       0     â”‚       2.3440e+01     â”‚        0       â”‚
â”‚       1     â”‚       1.3774e+00     â”‚        1       â”‚
â”‚       2     â”‚       1.6267e-02     â”‚        1       â”‚
â”‚       3     â”‚       2.4336e-06     â”‚        1       â”‚
â”‚       4     â”‚       6.7452e-12     â”‚        1       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  0.000886 seconds (348 allocations: 2.298 MiB)</code></pre><p>Note that, in this case, we did not give the Jacobian. It was computed internally using Automatic Differentiation.</p><p>We can perform numerical continuation w.r.t. the parameter <span>$\alpha$</span>. This time, we need to provide additional parameters, but now for the continuation method:</p><pre><code class="language-julia hljs">optcont = ContinuationPar(dsmin = 0.01, dsmax = 0.2, ds= 0.1, p_min = 0., p_max = 4.2,
	newton_options = NewtonPar(max_iterations = 10, tol = 1e-9))</code></pre><p>Next, we call the continuation routine as follows.</p><pre><code class="language-julia hljs">br = continuation(prob, PALC(), optcont; plot = true)
nothing #hide</code></pre><p>The parameter axis <code>lens = @optic _.Î±</code> is used to extract the component of <code>par</code> corresponding to <code>Î±</code>. Internally, it is used as <code>get(par, lens)</code> which returns <code>3.3</code>.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>We don&#39;t need to call <code>newton</code> first in order to use <code>continuation</code>.</p></div></div><p>You should see</p><pre><code class="language-julia hljs">scene = title!(&quot;&quot;) #hide</code></pre><img src="3ca550a6.svg" alt="Example block output"/><p>The left figure is the norm of the solution as function of the parameter <span>$p=\alpha$</span>, the <em>y-axis</em> can be changed by passing a different <code>recordFromSolution</code> to <code>BifurcationProblem</code>. The top right figure is the value of <span>$\alpha$</span> as function of the iteration number. The bottom right is the solution for the current value of the parameter. This last plot can be modified by changing the argument <code>plotSolution</code> to <code>BifurcationProblem</code>.</p><div class="admonition is-info"><header class="admonition-header">Bif. point detection</header><div class="admonition-body"><p>Two Fold points were detected. This can be seen by looking at <code>br.specialpoint</code>, by the black	dots on the continuation plots when doing <code>plot(br, plotfold=true)</code> or by typing <code>br</code> in the REPL. Note that the bifurcation points are located in <code>br.specialpoint</code>.</p></div></div><h2 id="Continuation-of-Fold-points"><a class="docs-heading-anchor" href="#Continuation-of-Fold-points">Continuation of Fold points</a><a id="Continuation-of-Fold-points-1"></a><a class="docs-heading-anchor-permalink" href="#Continuation-of-Fold-points" title="Permalink"></a></h2><p>We get a summary of the branch by doing</p><pre><code class="language-julia hljs">br</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"> â”Œâ”€ Curve type: <span class="sgr36"><span class="sgr1">EquilibriumCont</span></span>
 â”œâ”€ Number of points: 58
 â”œâ”€ Type of vectors: <span class="sgr36"><span class="sgr1">Vector{Float64}</span></span>
 â”œâ”€ Parameter <span class="sgr36"><span class="sgr1">Î±</span></span> starts at 3.3, ends at 4.2
 â”œâ”€ Algo: <span class="sgr36"><span class="sgr1">PALC</span></span>
 â””â”€ Special points:

- #  1, <span class="sgr34"><span class="sgr1">      bp</span></span> at Î± â‰ˆ +4.04103799 âˆˆ (+4.04103799, +4.04115545), |Î´p|=1e-04, [<span class="sgr32"><span class="sgr1">converged</span></span>], Î´ = ( 1,  0), step =   5
- #  2, <span class="sgr34"><span class="sgr1">      bp</span></span> at Î± â‰ˆ +3.15565319 âˆˆ (+3.15565221, +3.15565319), |Î´p|=1e-06, [<span class="sgr32"><span class="sgr1">converged</span></span>], Î´ = (-1,  0), step =  23
- #  3, <span class="sgr1">endpoint</span> at Î± â‰ˆ +4.20000000,                                                                     step =  57
</code></pre><p>We can take the first Fold point, which has been guessed during the previous continuation run and locate it precisely. However, this only works well when the jacobian is computed analytically. We use automatic differentiation for that</p><pre><code class="language-julia hljs"># index of the Fold bifurcation point in br.specialpoint
indfold = 2

outfold = newton(
	#index of the fold point
	br, indfold)
BK.converged(outfold) &amp;&amp; printstyled(color=:red, &quot;--&gt; We found a Fold Point at Î± = &quot;, outfold.u.p, &quot;, Î² = 0.01, from &quot;, br.specialpoint[indfold].param,&quot;\n&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">--&gt; We found a Fold Point at Î± = 3.155650731611178, Î² = 0.01, from 3.155653188706849</code></pre><p>We can finally continue this fold point in the plane <span>$(Î±, Î²)$</span> by performing a Fold Point continuation. In the present case, we find a Cusp point.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>We don&#39;t need to call <code>newton</code> first in order to use <code>continuation</code> for the codim 2 curve of bifurcation points.</p></div></div><pre><code class="language-julia hljs">outfoldco = continuation(br, indfold,
	# second parameter axis to use for codim 2 curve
	(@optic _.Î²),
	# we disable the computation of eigenvalues, it makes little sense here
	ContinuationPar(optcont, detect_bifurcation = 0))
scene = plot(outfoldco, plotfold = true, legend = :bottomright)</code></pre><img src="6b1db089.svg" alt="Example block output"/><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>The performances for computing the curve of Fold is not that great. It is because we use the default solver tailored for ODE. If you pass <code>jacobian_ma = :minaug</code> to the last <code>continuation</code> call, you should see a great improvement in performances.</p></div></div><h2 id="Using-GMRES-or-another-linear-solver"><a class="docs-heading-anchor" href="#Using-GMRES-or-another-linear-solver">Using GMRES or another linear solver</a><a id="Using-GMRES-or-another-linear-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Using-GMRES-or-another-linear-solver" title="Permalink"></a></h2><p>We continue the previous example but now using Matrix Free methods. The user can pass its own solver by implementing a version of <code>LinearSolver</code>. Some linear solvers have been implemented from <code>KrylovKit.jl</code> and <code>IterativeSolvers.jl</code> (see <a href="../../linearsolver/#Linear-solvers-(LS)">Linear solvers (LS)</a> for more information), we can use them here. Note that we can also use preconditioners as shown below. The same functionality is present for the eigensolver.</p><pre><code class="language-julia hljs"># derivative of N
dN(x; a = 0.5, b = 0.01) = (1-b*x^2+2*a*x)/(1+b*x^2)^2

# Matrix Free version of the differential of F_chan
# Very easy to write since we have F_chan.
# We could use Automatic Differentiation as well
function dF_chan(x, dx, p)
	(;Î±, Î²) = p
	out = similar(x)
	n = length(x)
	out[1] = dx[1]
	out[n] = dx[n]
	for i=2:n-1
		out[i] = (dx[i-1] - 2 * dx[i] + dx[i+1]) * (n-1)^2 + Î± * dN(x[i], b = Î²) * dx[i]
	end
	return out
end

# we create a new linear solver
ls = GMRESKrylovKit(dim = 100)

# and pass it to the newton parameters
optnewton_mf = NewtonPar(verbose = true, linsolver = ls, tol = 1e-10)

# we change the problem with the new jacobian
prob = re_make(prob;
	# we pass the differential a x,
	# which is a linear operator in dx
	J = (x, p) -&gt; (dx -&gt; dF_chan(x, dx, p))
	)

# we can then call the newton solver
out_mf = @time BK.solve(prob, Newton(), optnewton_mf)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Newton step         residual      linear iterations â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       0     â”‚       2.3440e+01     â”‚        0       â”‚
â”‚       1     â”‚       1.3774e+00     â”‚       68       â”‚
â”‚       2     â”‚       1.6267e-02     â”‚       98       â”‚
â”‚       3     â”‚       2.4336e-06     â”‚       74       â”‚
â”‚       4     â”‚       5.6275e-12     â”‚       63       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  0.003172 seconds (38.05 k allocations: 3.210 MiB, 0.07% compilation time)</code></pre><p>We can improve this computation, <em>i.e.</em> reduce the number of <code>Linear-Iterations</code>, by using a preconditioner</p><pre><code class="language-julia hljs">using SparseArrays

# define preconditioner which is basically Î”
P = spdiagm(0 =&gt; -2 * (n-1)^2 * ones(n), -1 =&gt; (n-1)^2 * ones(n-1), 1 =&gt; (n-1)^2 * ones(n-1))
P[1,1:2] .= [1, 0.];P[end,end-1:end] .= [0, 1.]

# define gmres solver with left preconditioner
ls = GMRESIterativeSolvers(reltol = 1e-4, N = length(sol.u), restart = 10, maxiter = 10, Pl = lu(P))
optnewton_mf = NewtonPar(verbose = true, linsolver = ls, tol = 1e-10)
out_mf = @time BK.solve(prob, Newton(), optnewton_mf)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Newton step         residual      linear iterations â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       0     â”‚       2.3440e+01     â”‚        0       â”‚
â”‚       1     â”‚       1.3777e+00     â”‚        3       â”‚
â”‚       2     â”‚       1.6266e-02     â”‚        3       â”‚
â”‚       3     â”‚       2.3699e-05     â”‚        2       â”‚
â”‚       4     â”‚       4.8929e-09     â”‚        3       â”‚
â”‚       5     â”‚       5.6333e-12     â”‚        4       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  0.000582 seconds (552 allocations: 1.487 MiB)</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Sunday 13 April 2025 19:29">Sunday 13 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
