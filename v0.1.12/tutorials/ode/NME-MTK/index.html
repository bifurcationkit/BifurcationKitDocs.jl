<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Neural mass equation - MTK · Bifurcation Analysis in Julia</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="Bifurcation Analysis in Julia logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Bifurcation Analysis in Julia</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../guidelines/">Overview</a></li><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Functionalities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../plotting/">Plotting</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Nonlinear Equations (Newton)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../newton/">Krylov-Newton algorithm</a></li><li><a class="tocitem" href="../../../deflatedproblem/">Deflated problems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Periodic Orbits</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../periodicOrbit/">Introduction</a></li><li><a class="tocitem" href="../../../periodicOrbitTrapeze/">Trapezoid</a></li><li><a class="tocitem" href="../../../periodicOrbitCollocation/">Collocation</a></li><li><a class="tocitem" href="../../../periodicOrbitShooting/">Shooting</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Symmetries / Waves</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../intro_wave/">Introduction</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Continuation methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../IntroContinuation/">Introduction</a></li><li><a class="tocitem" href="../../../Predictors/">Predictors / correctors</a></li><li><a class="tocitem" href="../../../PALC/">PALC</a></li><li><a class="tocitem" href="../../../MooreSpence/">Moore-Penrose Continuation</a></li><li><a class="tocitem" href="../../../DeflatedContinuation/">Deflated Continuation</a></li></ul></li><li><a class="tocitem" href="../../../EventCallback/">Event Handling and Callback</a></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Bifurcations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../detectionBifurcation/">Bifurcation detection (codim 1)</a></li><li><a class="tocitem" href="../../../codim2Continuation/">Fold / Hopf Continuation (codim 2)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-8" type="checkbox"/><label class="tocitem" for="menuitem-4-8"><span class="docs-label">Normal form</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../simplebp/">Simple branch point</a></li><li><a class="tocitem" href="../../../nonsimplebp/">Non-simple branch point</a></li><li><a class="tocitem" href="../../../simplehopf/">Simple Hopf point</a></li><li><a class="tocitem" href="../../../cusp/">Cusp point</a></li><li><a class="tocitem" href="../../../bt/">Bogdanov-Takens point</a></li><li><a class="tocitem" href="../../../bautin/">Bautin point</a></li></ul></li><li><a class="tocitem" href="../../../branchswitching/">Branch switching</a></li><li><a class="tocitem" href="../../../BifurcationDiagram/">Bifurcation diagram</a></li><li><a class="tocitem" href="../../../constrainedproblem/">Constrained problem</a></li><li><a class="tocitem" href="../../../diffeq/">DiffEq wrapper</a></li><li><a class="tocitem" href="../../../iterator/">Iterator Interface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Options</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../linearsolver/">Linear Solvers</a></li><li><a class="tocitem" href="../../../borderedlinearsolver/">Bordered linear solvers</a></li><li><a class="tocitem" href="../../../eigensolver/">Eigen Solvers</a></li><li><a class="tocitem" href="../../../Borderedarrays/">Bordered arrays</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Contributing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Interfaces</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../interfaceLS/">Linear/Eigen Solvers</a></li><li><a class="tocitem" href="../../../interfacePred/">Predictor/Corrector</a></li><li><a class="tocitem" href="../../../interfaceFlow/">Flow</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../faq/">Frequently Asked Questions</a></li><li><a class="tocitem" href="../../../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Neural mass equation - MTK</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Neural mass equation - MTK</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/bifurcationkit/BifurcationKitDocs.jl/blob/main/docs/src/tutorials/ode/NME-MTK.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Neural-mass-equation-MTK"><a class="docs-heading-anchor" href="#Neural-mass-equation-MTK">Neural mass equation - MTK</a><a id="Neural-mass-equation-MTK-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-mass-equation-MTK" title="Permalink"></a></h1><ul><li><a href="#Neural-mass-equation-MTK">Neural mass equation - MTK</a></li><li class="no-marker"><ul><li><a href="#Branch-of-periodic-orbits-with-Collocation-method">Branch of periodic orbits with Collocation method</a></li><li class="no-marker"><ul><li><a href="#Plot-of-some-of-the-periodic-orbits-as-function-of-E_0">Plot of some of the periodic orbits as function of <span>$E_0$</span></a></li></ul></li><li><a href="#References">References</a></li></ul></li></ul><p>In this tutorial, we study the following model taken from <sup class="footnote-reference"><a id="citeref-Cortes" href="#footnote-Cortes">[Cortes]</a></sup>. It is essentially the same tutorial as in <a href="../tutorialsODE/#Neural-mass-equation-(Hopf-aBS)">Neural mass equation (Hopf aBS)</a> but treated with <a href="https://mtk.sciml.ai/stable/">ModelingToolkit.jl</a>.</p><p class="math-container">\[\left\{\begin{array}{l}
\tau \dot{E}=-E+g\left(J u x E+E_{0}\right) \\
\dot{x}=\tau_{D}^{-1}(1-x)-u E x \\
\dot{u}=U E(1-u)-\tau_{F}^{-1}(u-U)
\end{array}\right.\]</p><p>The model is interesting because the branch of periodic solutions converges to an homoclinic orbit which is challenging to compute with our methods.</p><p>It is easy to encode the ODE as follows</p><pre><code class="language- hljs">using Revise, ModelingToolkit, Setfield, LinearAlgebra
using DifferentialEquations, Plots
using BifurcationKit
const BK = BifurcationKit

norminf(x) = norm(x, Inf)
indexof(sym, syms) = findfirst(isequal(sym),syms)

@variables t E(t) x(t) u(t) SS0(t) SS1(t) 	# independent and dependent variables
@parameters U0 τ J E0 τD U0 τF τS α    		# parameters
D = Differential(t) 				# define an operator for the differentiation w.r.t. time

# define the model
@named NMmodel = ODESystem([SS0 ~ J * u * x * E + E0,
	SS1 ~ α * log(1 + exp(SS0 / α)),
	D(E) ~ (-E + SS1) / τ,
	D(x) ~ (1.0 - x) / τD - u * x * E,
	D(u) ~ (U0 - u) / τF +  U0 * (1 - u) * E],
	defaults = Dict(E =&gt; 0.238616, x =&gt; 0.982747, u =&gt; 0.367876,
	α =&gt; 1.5, τ =&gt; 0.013, J =&gt; 3.07, E0 =&gt; -2.0, τD =&gt; 0.200, U0 =&gt; 0.3, τF =&gt; 1.5, τS =&gt; 0.007))

# get the vector field and jacobian
odeprob = ODEProblem(structural_simplify(NMmodel), [], (0.,10.), [], jac = true)
odefun = odeprob.f
F = (u,p) -&gt; odefun(u,p,0)
J = (u,p) -&gt; odefun.jac(u,p,0)

# we collect the differentials together
jet = BK.getJet(F, J)
nothing #hide</code></pre><p>We first compute the branch of equilibria </p><pre><code class="language- hljs"># continuation options
opts_br = ContinuationPar(pMin = -10.0, pMax = -0.9,
	# parameters to have a smooth result
	ds = 0.04, dsmax = 0.05,
	# this is to detect bifurcation points precisely with bisection
	detectBifurcation = 3,
	# Optional: bisection options for locating bifurcations
	nInversion = 8, maxBisectionSteps = 25, nev = 3)

id_E0 = indexof(E0, parameters(NMmodel))
par_tm = odeprob.p
# continuation of equilibria
br, = continuation(jet[1], jet[2], odeprob.u0, par_tm, (@lens _[id_E0]), opts_br;
	recordFromSolution = (x, p) -&gt; (E = x[1], x = x[2], u = x[3]),
	tangentAlgo = BorderedPred(),
	normC = norminf)

scene = plot(br, plotfold=false, markersize=3, legend=:topleft)</code></pre><p>With detailed information:</p><pre><code class="language- hljs">br</code></pre><h2 id="Branch-of-periodic-orbits-with-Collocation-method"><a class="docs-heading-anchor" href="#Branch-of-periodic-orbits-with-Collocation-method">Branch of periodic orbits with Collocation method</a><a id="Branch-of-periodic-orbits-with-Collocation-method-1"></a><a class="docs-heading-anchor-permalink" href="#Branch-of-periodic-orbits-with-Collocation-method" title="Permalink"></a></h2><p>We then compute the branch of periodic orbits from the last Hopf bifurcation point (on the right). We use finite differences to discretize the problem of finding periodic orbits. Obviously, this will be problematic when the period of the limit cycle grows unbounded close to the homoclinic orbit.</p><pre><code class="language- hljs"># newton parameters
optn_po = NewtonPar(verbose = true, tol = 1e-8,  maxIter = 10)

# continuation parameters
opts_po_cont = ContinuationPar(dsmax = 0.1, ds= -0.0001, dsmin = 1e-4, pMax = 0., pMin=-5.,
	maxSteps = 110, newtonOptions = (@set optn_po.tol = 1e-7),
	nev = 3, plotEveryStep = 10, saveSolEveryStep=1)

# arguments for periodic orbits
# this is mainly for printing purposes
args_po = (	recordFromSolution = (x, p) -&gt; begin
		xtt = BK.getPeriodicOrbit(p.prob, x, @set par_tm[id_E0] = p.p)
		return (max = maximum(xtt[1,:]),
				min = minimum(xtt[1,:]),
				period = getPeriod(p.prob, x, @set par_tm[id_E0] = p.p))
	end,
	plotSolution = (x, p; k...) -&gt; begin
		xtt = BK.getPeriodicOrbit(p.prob, x, @set par_tm[id_E0] = p.p)
		plot!(xtt.t, xtt[1,:]; label = &quot;E&quot;, k...)
		plot!(xtt.t, xtt[2,:]; label = &quot;x&quot;, k...)
		plot!(xtt.t, xtt[3,:]; label = &quot;u&quot;, k...)
		plot!(br; subplot = 1, putspecialptlegend = false)
		end,
	normC = norminf)


Mt = 30 # number of time sections
	br_pocoll, ucoll, = @time continuation(jet...,
	# we want to branch form the 4th bif. point
	br, 4, opts_po_cont,
	# we want to use the Collocation method to locate PO, with polynomial degree 5
	PeriodicOrbitOCollProblem(Mt, 5);
	# regular continuation options
	args_po...)

scene = plot(br, br_pocoll, markersize = 3)
plot!(scene, br_pocoll.param, br_pocoll.min, label = &quot;&quot;)</code></pre><p>We plot the maximum (resp. minimum) of the limit cycle. We can see that the min converges to the smallest equilibrium indicating a homoclinic orbit.</p><h3 id="Plot-of-some-of-the-periodic-orbits-as-function-of-E_0"><a class="docs-heading-anchor" href="#Plot-of-some-of-the-periodic-orbits-as-function-of-E_0">Plot of some of the periodic orbits as function of <span>$E_0$</span></a><a id="Plot-of-some-of-the-periodic-orbits-as-function-of-E_0-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-of-some-of-the-periodic-orbits-as-function-of-E_0" title="Permalink"></a></h3><p>We can plot some of the previously computed periodic orbits in the plane <span>$(E,x)$</span> as function of <span>$E_0$</span>:</p><pre><code class="language- hljs">plot()
# fetch the saved solutions
for sol in br_pocoll.sol[1:2:40]
	# periodic orbit
	po = sol.x
	# get the mesh and trajectory
	traj = BK.getPeriodicOrbit(br_pocoll.functional, po, @set par_tm[id_E0] = sol.p)
	plot!(traj[1,:], traj[2,:], xlabel = &quot;E&quot;, ylabel = &quot;x&quot;, label = &quot;&quot;)
end
title!(&quot;&quot;)</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Cortes"><a class="tag is-link" href="#citeref-Cortes">Cortes</a><blockquote><p>Cortes, Jesus M., Mathieu Desroches, Serafim Rodrigues, Romain Veltz, Miguel A. Muñoz, and Terrence J. Sejnowski. <strong>Short-Term Synaptic Plasticity in the Deterministic Tsodyks–Markram Model Leads to Unpredictable Network Dynamics.</strong>” Proceedings of the National Academy of Sciences 110, no. 41 (October 8, 2013): 16610–15. https://doi.org/10.1073/pnas.1316071110.</p></blockquote></li></ul></section></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.21 on <span class="colophon-date" title="Friday 22 July 2022 10:01">Friday 22 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
